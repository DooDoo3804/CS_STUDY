# 하루 3분 네트워크 교실

## 3. IP 어드레싱

### 1. 3계층의 역할과 개요

- 네트워크
    - 세그먼트 : 라우터와 라우터 간의 범위
    - **세그먼트 내**에서 데이터의 송수신을 하는 것이 **2계층**의 역할
    - **세그먼트 간**에서의 데이터 송수신을 하는 것이 **3계층**의 역할
    - 3계층의 네트워크 : 라우터와 라우터로 분배된 컴퓨터 그룹
- 인터넷 작업
    - 네트워크 내의 컴퓨터끼리는 2계층에 의해 연결되어 있음
    - 라우터를 넘어서는 브로드캐스트는 송신되지 않음
        - 1개의 큰 네트워크를 복수의 네트워크로 분할하여 브로드캐스트가 도달하는 범위를 제한
        - 전체 대수가 많아져도 각각의 네트워크에만 브로드캐스트가 도달하기 때문에 각 컴퓨터가 처리하는 브로드캐스트의 양을 줄일 수 있음
    - 인터넷 작업 : 네트워크 간의 데이터 송수신
    - 3계층은 인터넷 작업을 수행 → 떨어진 위치에 있는 컴퓨터끼리 데이터 통신이 가능

---

### 2. 인터넷 프로토콜

- 3계층의 역할과 IP
    - 어드레싱(addressing) : 3계층을 위한 주소가 필요
        - 논리 주소
        - 위치정보가 포함되어 있어 수신처를 찾을 수 있음
        - 어디의 네트워크에 있는 컴퓨터라는 정보
    - 라우팅(routing) : 수신처까지 어떤 경로로 갈 지를 결정
        - 여러 네트워크를 경유해야 될 경우 이를 결정하는 것이 라우팅
        - 패킷 교환기가 수신처에 연결되어 있는 회선을 선택하는 행위가 라우팅
        - 즉, 수신처에 연결되어 있는 네트워크를 선택해서 거기로 보내는 것
    - 어드레싱과 라우팅에 의해 인터넷 작업을 수행하기 위한 프로토콜로써 TCP/IP 프토로콜군에서 사용되는 것이 IP(Internet Protocol)
- 인터넷 프로토콜
    - TCP/IP에서는 반드시 IP를 사용
    - 2가지 버전이 존재(호환X)
        - IPv4
        - IPv6
    - IP 헤더
        1. 버전(4) : IP의 버전
        2. 헤더 길이(4) : IP 헤더의 길이
        3. 서비스 타입(8) : 패킷의 우선도/중요도
        4. 데이터 길이(16) : IP 헤더와 페이로드를 합친 길이
        5. ID(16) : 데이터그램의 식별 번호
        6. 플래그(3) : 데이터그램을 분할했는지 아닌지 판별
        7. 플래그먼트 오프셋(13) : 분할한 경우 본래대로 되돌릴 때 사용
        8. TTL(8) : 패킷의 생존 시간
        9. 프로토콜(8) : 상위 프로토콜 지정
        10. 헤더 체크섬(16) : IP헤더의 에러 체크용 코드
        11. 송신처 IP 주소(32) : 송신처의 논리 주소
        12. 수신처 IP 주소(32) : 수신처의 논리 주소
        13. 옵션(n) : 특별한 설정할 때 사용(필수 X)
    - IP 데이터그램(Datagram) : IP 헤더가 붙은 상태의 PDU

---

### 3. IP 주소 (1)

- IP 주소의 특징
    - 계층형 주소
        - MAC 주소와 같이 계층형이 아닌 주소는 평면형 주소라고 부름
    - 네트워크 관리자가 컴퓨터에 할당
        - MAC 주소는 IEEE가 붙인 벤더코드와 벤더가 붙인 할당코드로 이루어짐(사용자가 변경 X)
        - 네트워크에 접속할 때마다 붙임
        - 소속된 네트워크가 바뀔 경우 논리 주소도 바뀜
    - 3종류의 주소가 존재
        - 유니캐스트 → 논리 주소 중 네트워크를 표시하는 번호는 접속되어 있는 모든 네트워크에서 유일(접속하지 않으면 상관 X, 즉 독립된 네트워크끼리 상관 X)
        - 멀티캐스트
        - 브로드캐스트
        - ‘컴퓨터 번호’는 소속된 네트워크 내에서 유일 → 네트워크 번호 + 컴퓨터 번호 == 유일
- IP 주소
    - IPv4는 32비트, IPv6는 128비트임
    - IPv4는 8비트마다 10진수로 표기하고, 8비트 사이에 점을 찍어 표현(옥텟)
        - 제1옥텟.제2옥텟.제3옥텟.제4옥텟
    - 클래스에 의해 네트워크 번화와 컴퓨터 번호가 정해짐

### 4. IP 주소 (2)

- IP 주소의 클래스
    - 네트워크 번호
        - ICANN(The Internet Corporation for Assigned Names and Number)이라는 조직에서 할당
        - IP 주소를 가지고 있다가 기업이나 인터넷 사업자에게 빌려줌
        - 조직의 규모에 따라 IP 주소의 범위를 변경 == 클래스
    - 클래스는 A~E(5개)로 나뉘어져 있음
        - 클래스A : 네트워크 8비트 + 컴퓨터 24비트
        - 클래스B : 네트워크 16비트 + 컴퓨터 16비트
        - 클래스C : 네트워크 24비트 + 컴퓨터 8비트
        - 클래스D, E : 특별한 주소라 보통은 할당 X
        - 각 클래스를 식별하는 법 : 최초 옥텟의 맨 앞 몇 비트로 판별
        - 네트워크 번호 부분의 비트 수가 적으면 그만큼 컴퓨터 번호 부분의 비트 수가 많아짐 → 많은 컴퓨터를 소유하는 네트워크
        - 큰 규모 네트워크에는 A, 작은 규모에는 C를 할당
    - 클래스풀 어드레싱(Classfull Addressing) : 클래스로 나누어 IP 주소를 할당
- 예약 완료 주소
    - 컴퓨터 번호(호스트 번호)는 해당 네트워크의 관리자가 마음대로 정함
    - 호스트 번호가 모두 0이거나 1인 주소는 특별한 의미를 가짐
        - 클래스 C의 네트워크 번호가
        - 192.168.10.0 인 경우 : 호스트가 소속된 네트워크 자체를 표시하는 주소**(네트워크 주소)**
        - 192.168.10.255인 경우 : 소속된 호스트 모두를 표시하는 주소**(브로드캐스트 주소)**

---

### 5. 서브네팅

- 네트워크 분할
    - 계층형 주소 : 커다란 네트워크 안에 작은 네트워크를 만들어 분할
    - 서브네트워크, 서브넷(Subnetwork) : 분할된 작은 네트워크
        - 서브넷으로 분할하기 위해서 서브넷 번호가 필요
        - 서브넷 번호를 추가할 수 없기 때문에 호스트 번호의 비트를 서브넷 번호와 호스트 번호로 분할
- 서브넷 마스크
    - 서브넷은 그 네트워크 내부에서만 유효함
    - 서브네팅(Subnetting) : 서브넷화 하는 것
        - 서브넷의 숫자를 크게하면 각 서브넷의 호스트 수는 감소
        - 서브넷 부분에 비트수를 뺏기기 때문
    - 네트워크 소속을 아는 방법
        - IP 주소의 어디까지가 네트워크 주소(서브넷 번호)인지 알아야 함
        - 서브넷 마스크(Subnetmask)라고 불리는 비트열을 IP 주소와 동시에 표기해야함
        - 서브넷 마스크는 IP주소 중 어디까지가 서브넷 번호인지를 나타냄
        - IP주소와 같은 32비트, 네트워크 번호 및 서브넷 번호의 비트를 모두 1, 호스트 번호를 0으로 표현
        - IP 주소와 서브넷마스크는 반드시 세트로 기술

---

### 6. 클래스리스 어드레싱

- 클래스풀과 클래스리스
    - 현재는 **클래스풀 어드레싱을 사용하지 않음**
    - 크기를 3개로만 구분 → 구분에 딱 맞지 않으면 낭비가 많아짐(사용되지 않는 IP 주소량 증가)
    - 이를 해결하기 위해 등장한 것이 클래스리스 어드레싱(Classless Addressing)
- 클래스리스 어드레싱
    - 클래스라는 구분을 없앤 어드레싱
    - 클래스에 따른 고정된 할당을 하지 않고 필요에 따라 자유롭게 할당
        - 예를 들어 네트워크 번호가 18비트라면 호스트 부분에 사용할 수 있는 비트는 32-18=14비트
    - 슈퍼넷(Super Network) : 클래스에 의한 할당 클래스풀 어드레싱 → 클래스를 통합해서 1개로 하는 것
    - 어디까지가 네트워크 번호인지를 나타내는 값을 부여할 필요
        - 프리픽스 길이(Prefix-Length)
        - 네트워크 번호의 길이를 나타내는 값
        - 주소 뒤에 슬래시를 넣고 네트워크 번호 비트 수를 기술(/1~31)

---

### 7. DHCP

- 송신처의 IP 주소와 MAC 주소
    - 이더넷을 사용해서 IP 데이터그램을 송수신하기 위해 필요한 4개의 주소
        - 수신처 MAC 주소
        - 송신처 MAC 주소
        - 수신처 IP 주소
        - 송신처 IP 주소
    - 송신처 MAC 주소
        - 송신할 인터페이스의 MAC 주소 사용
    - 송신처 IP 주소
        - 송신할 인터페이스에 설정되어 있는 IP 주소 사용
        - 정적 IP 주소 설정 : 수동으로 IP 주소 설정 - 네트워크 관리자가 정한 IP 주소를 자신의 컴퓨터에 입력
        - 동적 IP 주소 설정 : 자동으로 IP  주소 설정 - (DHCP) 프로토콜 사용
    - DHCP
        - Dynamic Host Configuration Protocol
        - 할당한 IP 주소를 관리하고, 실제로 할당 작업을 수행하는 서버(Server)하고 할당 받는 클라이언트(Client)로 이루어짐
        - DHCP 서버 : DHCP 서버 소프트웨어라는 전용 소프트웨어 실행
        - DHCP 클라이언트 : DHCP 클라이언트 소프트웨어 실행
        - IP 주소 풀 : 사전에 관리자가 할당할 주소의 범위 - 서버는 설정된 IP 주소 풀 중에서 요청한 클라이언트에게 각각 유일한 것이 되도록 주소를 할당
        - 사전에 IP 주소의 대여 기간 결정 - 호스트가 이동하거나 고장났을 경우 IP 해당 주소를 점유하지 못하도록 → 클라이언트 측에서 계속 사용하고 싶으면 기간 연장을 신청
    - DHCP 메시지 : DHCP에서 주고 받는 내용
        - 이더넷 헤더 - IP 헤더 - UDP 헤더 - DHCP 메시지
        - 오퍼레이션 코드(1옥텟) : 1) 클라 → 서버 2) 서버 → 클라
        - 클라이언트 IP 주소(4옥텟) : 현재의 클라이언트 주소(재 대여 시에만)
        - 할당 IP 주소(4옥텟) : 서버가 할당한 주소
        - 서버 IP 주소(4옥텟) : 서버 주소
        - 클라이언트 하드웨어 주소(16옥텟) : 클라이언트의 MAC 주소
        - **옵션(가변) : 메시지 타입과 클라이언트 설정(서브넷 마스크, 디폴트게이트웨이, DNS서버주소, 대여기간 등**
    - DHCP의 동작
        - DISCOVER, OFFER, REQUEST, ACK 4종류의 메시지 사용
        1. 클라이언트는 DHCP DISCOVER 메시지를 브로드캐스트
        2. DISCOVER를 받은 서버는 할당할 IP 주소를 풀에서 선택해 그것을 클라이언트에게 브로드캐스트해서 통지(DHCP OFFER)
        3. 클라이언트는 OFFER에서 받은 IP 주소로 문제가 없으면 DHCP REQUEST를 서버에 브로드캐스트
        4. REQUEST를 받은 서버는 문제가 없으면 DHCP ACK를 보냄. 그 때서브넷마스크 등 옵션 설정도 ACK에 넣어 보냄
    - 호스트 설정 프로토콜
        - IP 주소만이 아니라 다른 네트워크의 설정 정보도 보낼 수 있음
        - 송수신은 브로드캐스트를 활용 → 클라이언트는 누구에게 메시지를 보내면 좋을지 모르기 때문

---

### 8. ARP

- 주소해결 프로토콜
    - 수신처의 MAC 주소는 수신처의 IP 주소가 결정된 후에 정해짐
    - ARP(Address Resloution Protocol, 주소 해결 프로토콜)
        - IP 주소의 호스트에게 MAC 주소를 받아오는 프로토콜
        - MAC 주소를 모르는 상태를 해결
- ARP 테이블과 ARP
    - 데이터를 전송하고 싶은 컴퓨터는 수신처의 IP 주소를 결정 → 수신처 MAC 주소를 알기 위해 ARP 테이블을 참조
    - ARP 테이블은 IP 주소와 MAC 주소의 대응표
        - ARP 테이블에 수신처 IP 주소와 MAC 주소의 대응이 없는 경우 MAC의 주소를 알 수없음 → 대응 기재
    - ARP를 사용해 묻고**(ARP 요청)** 그 결과를 ARP 테이블에 기재
        - ARP 요청은 브로드캐스트로 네트워크 내의 모든 컴퓨터에 송신
    - ARP 요청을 받은 컴퓨터 중 지정된 IP 주소를 갖는 컴퓨터만 **ARP 응답**을 보냄
        - ARP 응답을 받은 컴퓨터는 ARP의 결과를 ARP 테이블에 기재
        - 일정 기간이 지나면 파기

---

### 9. DNS

- 수신처 IP 주소를 안다
    - 수신처의 IP 주소를 알고 있을 경우 데이터를 전송할 수 있음
    - 단순한 숫자인 IP 주소는 외우기 어려움
        - 도메인 명(Domain Name) 사용
- DNS
    - 도메인 명 : 송신할 상대의 컴퓨터 이름
        - 유일한 이름
        - IP 주소와 마찬가지로 ICANN이 관리
        - 송신하고 싶은 상대를 간단하게 기억할 수 있도록 되어 있음
        - but 결국 IP 주소가 필요함
    - DNS(Domain Name System)
        - 이름과 IP 주소를 대응시킨 시스템
        - 이름과 IP 주소의 대응 DB를 갖고 있는 DNS 서버에 문의해 수신처의 IP 주소를 입수
    - DNS 서버
        - 각 조직에 1개씩 있음
        - 해당 조직의 도메인 명만 관리
        - 다른 조직의 호스트 명과 도메인 명은 해당 조직의 DNS 서버에 물어봄
        - DNS란 전 세계의 도메인 명 및 호스트 명을 관리하는 일종의 분산형 DB
    - DNS는 현재의 인터넷을 지탱하는 기간 기술
- 4개의 주소 완결
    - 송신처 MAC 주소는 NIC를 장치하면 자동적으로 알 수 있음
    - 송신처 IP 주소는 수동 또는 DHCP로 할당 받아서 알 수 있음
    - 수신처의 도메인 명을 결정할 경우 DNS로 수신처 IP 주소를 알 수 있음
    - 수신처의 IP명을 알면 ARP로 수신처 MAC 주소를 알 수 있고 데이터 전송이 가능해짐
- 데이터 전송을 하기까지의 흐름
    - DHCP, ARP, DNS를 사용하여 4개의 주소 결정
        - 자신의 IP 주소는 수동 또는 DHCP에서 할당 받고, MAC 주소는 자동적으로 앎
        - 사용자 애플리케이션이 수신처의 도메인 명을 결정하면 DNS로 IP 주소를 취득함
        - IP 주소가 결정된 후, ARP에 의해 MAC 주소를 취득
        - 이것으로 송신처, 수신처의 MAC 주소, IP 주소를 알았기 때문에 데이터 전송이 가능해짐

---