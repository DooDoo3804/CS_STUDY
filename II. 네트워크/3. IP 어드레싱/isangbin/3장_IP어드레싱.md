# 3장

## 19. 3계층의 역할과 개요

세그먼트 = 네트워크 = 라우터 + 라우터로 분배된 컴퓨터 그룹

네트워크 내 컴퓨터끼리는 2계층에 의해 연결됨 (p2p네트워크, 멀티액세스네트워크로)



3계층이 필요한 이유(+없을때 문제점)

- 2계층 스위치는 충돌은 제어하지만 브로드캐스트는 제어하지 않음(플러딩발생)
  - 큰 네트워크를 라우터 기준으로 작은 네트워크로 나눠 라우터를 넘어서는 브로드캐스트는 송신X
- 2계층은 같은 세그먼트 내 인접기기와의 통신 기능임. 그럼 네트워크와 네트워크 간의 통신은?
  - 3계층을 통해 이들을 연결해 통신이 가능하게 함(인터넷 작업)



## 20. 인터넷 프로토콜

어드레싱 :

다른 네트워크로 연결되면 위치정보가 없는 MAC주소로는 정보가 부족함 (벤더+벤더할당 뿐)

- 3계층은 어디에있다 라는 위치정보가 포함된 '논리주소' 를 추가로 사용

- MAC주소와 논리주소가 합쳐져 ''어디의 네트워크에 있는 어느 컴퓨터'' 라는 조합이 완성됨



라우팅 :

경로선택. 수신처(주소)까지 어떤 경로로 이동할 지를 결정. 라우터에서 수행함



IP :

위 두 기능을 수행하기 위한 프로토콜이 TCP/IP의 IP (internet protocol)

- 두 작업 수행을 위해 PDU에 IP헤더를 붙여 IP데이터그램을 만듦



## 21. IP주소 1

IP주소는 논리 주소임 (32비트. 8개마다 구분함 = 옥텟. 123.0.0.1 같은거)

논리주소 특 : 

- 계층형이다. (어디 안의 어디 안의 어디 형식으로 세분화됨)

- 네트워크 관리자가 컴퓨터에 할당함 (네트워크에 접속할 때 마다 붙임)



MAC주소 : 인터페이스에 포함되므로 어디에 있어도 같은 주소. 대신 인터페이스 바꾸면 바뀜

논리주소 : 소속된 네트워크가 변하지 않는다면 인터페이스를 교체해도 변하지 않음



논리주소도 유니, 멀티, 브로드캐스트 주소가 있음

- 유니캐스트 주소의 논리 주소 중 네트워크를 표시하는 번호는 접속된 모든 네트워크에서 유일해야함



## 22. IP주소 2

클래스 : 할당된 조직의 규모에 따라 할당할 IP주소의 범위를 변경

A~E클래스가 있고, 1옥텟의 앞자리를 보면 알 수 있음 

A - 0xxxxxxx	앞8비트가 네트워크번호, 뒷24비트가 컴퓨터번호(호스트번호)

B - 10xxxxxx    16 / 16

C - 110xxxxx	24 / 8

D - 1110xxxx

E - 1111xxxx

큰 넷웍일수록 A, 작을수록 아래에 할당 -> 클래스풀 어드레싱



사용하면 안되는 번호

00000000 > 네트워크 자체의 주소

11111111 > 브로드캐스트 주소



## 23. 서브네팅

서브네팅 : 서브넷화 하는 것

서브넷 : 큰 네트워크에서 분할(세분화)된 작은 네트워크

서브넷마스크 : 

호스트 번호의 비트를 일부 분할해 서브넷 번호로 사용하는데, 몇자리까지 사용했는지 알려주는 비트열. 32비트임 (ex. 111111....1100000000 이면 뒤에 8자리가 서브넷번호임을 의미)



## 24. 클래스리스 어드레싱

클래스 구분을 없앤 어드레싱.

슈퍼넷 : 원래 쓰던 할당 클래스풀 어드레싱을 하나로 통합한 것 (클래스C 네트워크 8개를 모아 더 큰걸 만드는 등)

- 이러면 C로는 모자라고 B로는 너무남는 경우 적절한 슈퍼넷을 만들어 사용 가능



프리픽스 길이 : 클래스리스에서의 서브넷마스크 역할 (192.168.32.0 / 21 <-)



## 25. DHCP

이더넷으로 IP 데이터그램을 송수신하려면 송수신처 MAC주소, 송수신처 IP주소 총 4개가 필요함

송신처 MAC주소는 송신할 인터페이스의 MAC주소임

송신처 IP주소 :

- 정적 설정 : 네트워크 관리자가 수동으로 IP주소 설정
- 동적 설정 : DHCP 프로토콜에 의한 자동 설정 (Dynamic Host Configuration Protocol)



DHCP :

- 서버(IP주소 관리, 실제로 할당작업 수행), 클라이언트(할당을 받음)으로 이루어짐
- IP 주소 풀 : 관리자가 할당할 주소의 범위
- 서버는 설정된 IP주소 풀 중에서 요청한 클라이언트에게 각각 유일한 것이 되도록 주소를 할당함
- 호스트에게 문제가 생기면 서버는 이미 IP주소를 줬기때문에 주소하나가 증발함
  - 고로 IP주소에 대여기간을 결정해둬서 주기적으로 계속쓸건지 회수할지를 결정
- 옵션 (중요)
  - DISCOVER -> OFFER -> REQUEST -> ACK 순으로 브로드캐스트를 사용해 client, server간 메시지교환



## 26. ARP

수신처 MAC주소는 수신처 IP주소가 결정된 후 정해짐.



ARP(Address Resolution Protocol) :

- 주소 해결 프로토콜
- 수신처 IP주소에 대한 MAC주소를 브로드캐스트로 질문 (ARP 요청)
- 해당 IP를 갖고있는 컴퓨터가 MAC주소를 알려줌 (ARP 응답)
- ARP 테이블에 수신처 IP와 MAC주소의 대응을 기록함. (300초 뒤 파기)
  - 파기하는 이유 : 인터페이스를 교체하면 MAC주소가 변경되는데 기록을 평생 유지시키면 IP는 그대론데 MAC이 바뀌어있어 데이터를 평생 못받음



## 27. DNS

: 수신처 IP주소를 알아내는 방법 이름과 IP주소를 대응시킨 시스템

각 조직마다 1개의 DNS 서버를 가지고 있고, 이 서버는 그 조직의 도메인 명만 관리한다.

다른 조직의 호스트명, 도메인명은 그 조직의  DNS서버가 알고 있는 것.

이를 일종의 분산형 데이터베이스 라고 함