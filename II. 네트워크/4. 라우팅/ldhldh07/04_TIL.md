# 라우팅

## 주소와 경로

### IP 주소와 MAC 주소

MAC 주소 : 같은 네트워크 내에서의 수신처

IP 주소 수신처의 컴퓨터

IP 주소가 데이터의 최종 수신처가 되고, MAC 주소가 그 다음에 정의되는 수신처가 되는 것이다

- 인터넷 작업에서 데이터는 복수의 네트워크를 경유해서 최종 수신 컴퓨터까지 돌달함
- 어디를 통해서 경유할지 알아야 함
- 예) 어떤 네트워크A 에서 네트워크B를 경유해서 네트워크C에 간다고 할 떄, A에서 나온 데이터그램은 B로 들어가고, 이어서 C로 가는데, B로 들어간 시점에서 C로 중계해 줄 어딘가의 장소로 가야 한다
  - MAC 주소로 '다음으로 보낼 장소'를 결정

- MAC 주소로 다음에 보낼 장소를 지정하고 거기에 도달하면 다시 MAC 주소로 다음에 보낼 장소를 지정하는 것을 반복해서 최종 수신처에 도달함
- 수신처가 될 MAC 주소는 계속 바뀜
- 그 컴퓨터에 도달하면 이어서 다음을 지정할 필요가 있음
- MAC 주소는 변경되는 것이고, 반면 IP 주소는 변경이 없다

예) 

송신처: X -> Y

- 수신처
  - 논리 주소 : AA
    - 수신처 A의 논리 주소인 AA
  - 물리 주소 : yy
    - 동일 네트워크 안에서 중계를 해주는 장치 yy

Y->Z

- 장치가 Y가 중계해서 송신할 경우

- 수신처
  - 논리 주소 : AA
    - 논리 주소는 변함없이 AA
  - 물리 주소 : zz
    - 다음 중계처인 zz
    - 중계처가 명확하게 된다

### 경로

최종 수신처까지의 경로

- MAC 주소로 '다음 수신처' 지정
- IP 주소로 '최종 수신처'를 지정

라우터라는 장치가 이 경로를 결정하는 역할

자신의 위치에서 수신처까지 가기 위해 다음에 어디로 보내야 할지 그것만 결정

- 송신처에서 수신처까지의 모든 길을 이해하고 있는 것은 아니다

홉 바이 홉(Hop-by-Hop)

- 이렇게 반복해서 다음 길을 제시해 가는 방식
- 라우터는 다음 수신처를 결정하고 이것이 연결되어 경로가 된다
- 라우팅에서 '홉'이란 라우터를 가리키는 용어

복수의 라우터가 '다음' 수신처를 가리키는 과정을 반복함으로써 전체의 '경로'가 만들어져 감

라우터가 네트워크 경계상에 배치

- 전송받은 데이터그램을 라우팅해서 다음 수신처를 결정

다음 수신처

- 기본적으로는 수신처에 가기 위한 다음 라우터
- 수신처가 그 라우터와 접한 네트워크 내에 있는 경우에는 수신처의 컴퓨터 자체가 다음 수신처가 된다

라우터가 없으면 다음 네트워크에 데이터그램을 보낼 수 없다

- 라우터가 라우팅함으로써 다른 네트워크에 대한 경로가 생김
- 이 경로가 없으면 다른 네트워크에 도달하지 못한다
- 같은 허브에 연결되어 있더라도 다른 네트워크에 소속되어 있는 다른 한 대의 컴퓨터에는 데이터그램이 전달되지 않음
- 라우터가 없으면 다른 네트워크에는 전송할 수 없다
  - 컴퓨터는 다른 네트워크에 수신처가 있는 경우에는 라우터로 송신한다
  - 같은 네트워크에 수신처가 있는 경우에는 수신처에 직접 송신한다

컴퓨터가 송신하는 규칙

- 다른 네트워크 수신이면 라우터(디폴트 게이트웨이)로 동일 네트워크 수신이면 직접 통신한다
  1. 라우터(디폴트 게이트웨이)가 설정되어 있는 경우
     - 동일 네트워크 수신이면 수신처에 직접 송신한다
     - 다른 네트워크 수신이면 디폴트 게이트웨이에 설정된 라우터로 송신한다
  2. 라우터(디폴트 게이트웨이)가 설정되어 있지 않은 경우
     - 동일 네트워크 수신이면 수신처에 직접 송신한다
     - 다른 네트워크 수신이면 송신 불가능이 된다

디폴트 게이트웨이(Default Gateway)

- 컴퓨터에 '라우터가 설정되어 있지 않다면' 다른 네트워크에 대한 데이터 전송 자체가 불가능

## 라우터

### 라우터란

라우터는 복수의 인터페이스를 가질 수 있다

- 어떤 네트워크에서 다른 네트워크에 데이터그램을 보내는 역할을 하고 네트워크와 네트워크의 경계상에 배치

- 복수의 인터페이스를 가지고 거기서 복수의 네트워크에 연결되어 있다

라우터의 각 인터페이스는 각각의 네트워크에 소속되어 있는 형태

- 라우터의 인터페이스에는 논리 주소인 IP 주소가 설정되어 있다
- 각각 다른IP 주소를 가진다
- 라우터는 단독이 아니라 복수의 네트워크에 소속되어 있다

#### 라우팅

데이터그램의 수신처 IP 주소를 근거로 다음에 송신하는 라우터를 결정

이것을 수행함으로써 경로가 결정됨

#### 라우터의 역할

네트워크 경계상에 배치되어 라우팅한다

복수의 네트워크까리 연결

- 복수의 네트워크
  - LAN으로 사용되는 이더넷
  - WAN으로 사용되는 회선
- 이렇게 다른 종류의 네트워크를 연결하는 것도 라우터의 역할

- 다른 종류의 네트워크 사이에서 데이터 중계를 한다

필터링

- 전송받은 데이터그램에 대해 조건을 붙어 그 데이터그램을 파기하는 처리

- 예) 대학교 컴퓨터 실습실의 네트워크에서는 학생들의 데이터가 저장되어 있는 사무실의 네트워크로는 데이터를 전송하지 못하게 함

### 라우터의 동작

#### 라우팅 테이블

- 최적 경로의 지도
- 라우터가 수신한 패킷이 수신처까지 도달하기 위한 최적의 경로가 그려져 있는 지도

- 이걸 보고 라우터는 수신처 네트워크까지의 경로를 결정
- 기재된 것
  - 수신처 네트워크까지의 거리
  - 다음에 도달하는 라우터
  - 그 라우터에 연결되어 있는 자신의 인터페이스
- 라우팅 테이블이야말로 라우터의 중요한 요소

라우팅 테이블에서 수신처 네트워크를 찾아내어 다음에 도달하는 라우터를 결정하고 인터페이스에서 송신한다

1. 호스트로부터 패킷을 수신받는다.
2. 수신처 IP주소로부터 수신처 네트워크를 결정한다.
3. 라우팅 테이블에서 다음 중계할 라우터, 송신할 인터페이스가 결정된다
4. 결정된 인터페이스로부터 패킷을 송신한다.

#### 최장일치의 룰

롱기스트 매치(Longest Match)

실제 데이터그램의 수신처 IP 주소로부터 라우팅 테이블의 수신처 네트워크 주소를 결정해서 다음 라우터랑 송신 인터페이스를 결정

수신처 IP 주소와 수신처 네트워크 주소를 비교할 때 사용하는 규칙이 최장 일치의 룰

IP 주소의 비트열과 네트워크 주소의 비트열을 앞에서부터 순서대로 비교해서 가장 많이 일치하는 것부터 선택한다

프리픽스 길이까지 일치한 것 중에서도 가장 프리픽스 길이가 긴 경로를 사용한다

## 디폴트 게이트웨이

### 브로드캐스트 도메인

브로드캐스트는 라우터를 넘어서 전송할 수 없다

- 네트워크를 나눔으로써 브로드캐스트가 송신되는 양이 감소

브로드캐스트 도메인(Broadcast Domain)

- 라우터가 네트워크를 나누기 때문에 브로드캐스트가 다른 네트워크에 송신되지 않도록 한다

충돌 도메인 : 스위치가 구분

브로드캐스트 도메인 : 라우터가 구분

허브는 어느 쪽에도 영향을 미치지 않는다.

브로드캐스트 도메인=네트워크라고 생각해도 문제는 없다

### ARP와 라우터

ARP가 브로드캐스트

- ARP가 브로드캐스트라는건 라우터가 ARP를 다른 네트워크에 전송하지 않는다는 의미
- ARP는 수신처가 도달하지 않음
- 다른 네트워크에 있는 컴퓨터에 MAC 주소를 알 수 없게 됨

디폴트 게이트웨이 : 컴퓨터가 다음에 보낼 라우터

- 라우터는 네트워크의 경계상에 있고 다른 네트워크에 데이터그램을 라우팅

- 디폴트 게이트웨이가 네트워크의 출입구

### 디폴트 게이트웨이

다른 네트워크로 데이터를 전송하고 싶은 호스트는 일단 디폴트 게이트웨이로 데이터를 보내서 다른 네트워크로 전송한다

- 컴퓨터가 최초로 데이터를 보내는 수신처는 디폴트 게이트웨이가 됨

컴퓨터는 다른 네트워크에 데이터를 송신할 때 디폴트 게이트웨이로 ARP를 수행한다

- IP 주소는 최종 수신처, MAC는 다음 수신처를 정한다
- 컴퓨터가 다른 네트워크에 데이터를 송신할 경우의 수신처는 반드시 디폴트 게이트웨이의 MAC 주소가 된다
  1. 다른 네트워크에 데이터를 보내는 경우, 호스트는 디폴트 게이트웨이로 ARP를 수행해서 디폴트 게이트웨이의 MAC 주소를 입수한다.
  2. 호스트는 수신처 MAC 주소를 디폴트 게이트웨이로, 수신처 IP 주소를 수신처 호스트로 해서 패킷을 보낸다
  3. 수신받은 디폴트 게이트웨이는 라우팅을 하고, 중계 라우터, 송신포트를 결정하여 다음에 수신받을 상대(중계 라우터 또는 수신처)에게 ARP를 수행한다
  4. ARP에 의해 입수한 MAC 주소를 수신처 MAC 주소로, 자기 자신의 MAC 주소를 송신처 MAC 주소로 갱신하여 송신한다. IP 주소는 변경되지 않는다.

ARP로 디폴트 게이트웨이의 MAC 주소를 얻을 수 있다

- 컴퓨터가 수신처를 결정하면 수신처가 동일 네트워크가 아닌지 조사
- 동일 네트워크라면 수신처 IP 주소 수신으로 ARP를 실행해서 그 컴퓨터의 MAC 주소를 입수
- 다른 네트워크가 수신처라면 디폴트 게이트웨이의 MAC 주소를 얻음
- 컴퓨터에는 디폴트 게이트웨이의 IP 주소를 미리 설정
  - 설정 방법은 수동이나 DHCP
  - DHCP는 IP 주소 이외에 서브넷 마스크도 배포하고 디폴트 게이트웨이도 배포한다
  - 디폴트 게이트웨이가 설정되어 있지 않았을 경우 컴퓨터는 다른 네트워크에 데이터를 송신할 수 없다

## 라우팅

### 라우팅 테이블

라우팅 테이블

- 수신처 네트워크
- 중계지점
- 메트릭
- 수신처의 출구

라우터는 수신처 네트워크를 결정한다

- 매번 어떤 네트워크의 어떤 컴퓨터라는 것까지는 생각하지 않음

- 수신처 네트워크 주소와 라우팅 테이블을 비교해서 경로를 찾아내는 것

### 2개의 라우팅

수신처 네트워크까지의 최적 경로를 어떠게 찾아낼까

- 최적의 경로를 찾기 위해 다른 네트워크 경로를 모두 알아야 할 필요가 있다
- 알고 있는 경로 중에서 최적의 경로를 선택해서 라우팅 테이블을 작성

네트워크의 모든 경로를 알 수 있는 방법

- 정적 라우팅
- 동적 라우팅

#### 정적 라우팅

관리자가 수동으로 경로를 입력하는 것

이 네트워크에는 이 경로를 사용하세요

##### 단점

우회로

수동으로 입력한 경로를 사용할 수 없게 되는 경우가 일어날 수 있다

우회로 변경을 수동으로 수행할 필요가 있다

예) 장애 때문에 라우터X 경우는 네트워크A까지 도달하지 못함

- 정적으로 쓰여진 테이블이 라우터X 경우로 정해져 있기 때문에 라우터X를 경유해서 전송하려고 함
- 우회로인 라우터 Y 경유는 사용되지 않음

- 그 경우 관리자가 수동으로 경로를 다시 갱신할 필요가 있음
- 이 방법으로는 언제 일어날지도 모르는 장애를 대비하기 위해 관리자가 라우터 앞에 붙어 있어야 함

#### 동적 라우팅

자동화

- 라우터가 장애를 발견하면 마음대로 경로를 변경하도록 함

라우터가 자동으로 정보를 서로 교환해서 경로를 알아내는 방법

모든 경로 중에서 자동으로 최적의 경로를 선택해서 라우팅 테이블을 작성

- 장애가 있으면 최적의 경로가 아니니까 새로운 최적경로로 라우팅 테이블을 고쳐 씀

##### 단점

1. 데이터 전송에 사용되는 분량이 줄어듦

   - 라우터끼리 정보를 교환한다는 것은 서로 주고받는 것을 의미

   - 그만큼 회선 전송을 압박

   - 특히 저속회선을 사용하는 경우 주의가 필요

2. 서로 교환한 정보를 가지고 최적의 경로를 계산해야 함

   - 라우터의 처리 능력이 필요

   - 능력이 낮은 라우터의 경우 경로 계산 처리에 치우치다 보면, 데이터그램의 전송처리가 늦어짐

3. 모든 라우터가 동일한 정보를 가져아 함
   - 네트워크의 라우터들이 컨버전스가 되어야 함

##### 컨버전스

모든 라우터가 동일한 정보를 가지고 있는 상태

네트워크 내의 모든 라우터가 올바른 경로 정보를 가지지 않으면 수신처에 정확하게 도달하지 않는다

- 라우터 A는 X로부터 장애정보를 입수했기 때문에  라우터Y 경유로 변환
- 라우터Y는 아직 장애정보를 받지 않았기 때문에 라우터X 경유 상태로 남아있음
- 이 때문에 네트워크 A에는 도달하지 않음

자동으로 장애를 제거할 수 있다는 것은 그만큼 중요

## 라우팅 프로토콜

### 자율화 시스템

#### 라우팅 프로토콜(Rounting Protocol)

근접해 있는 라우터 간의 네트워크 정보를 서로 교환

교환한 정보를 근거로 라우팅 테이블을 변경

#### 자율화 시스템(Autonomous System)

하나의 관리 단체에 의해 관리되는 네트워크 집합체

머리글자를 가져와서 AS라고도 부른다

AS는 한 개의 범위로써 취급

인터넷에는 너무 많은 네트워크가 존재하기 때문에 같은 조직이 관리하는 복수의 네트워크를 AS로 통합해 버림 

복수의 네트워크를 통합해서 큰 단위의 라우팅을 수행한다

- 수신처의 AS에 전달하는 라우팅을 수행하고, AS 내부에서 각 네트워크에 전달하는 라우팅을 수행하는 단계

  - AS 내부에서늬 라우팅

  - AS 간 라우팅

  - AS에는 식별하기 위해 유일한 번호가 부여되어 있다

### 라우팅 프로토콜의 종류

#### AS 간 라우팅용

EGP(Exterior Gateway Protocol)

- BGP라고 불리는 프로토콜이 표준

#### AS 내부 라우팅용

IGP(Interior Gateway Protocol)

- 각각의 AS에서 그곳 관리자가 AS 상태에 맞춰서 프로토콜을 선택함

EGP와 IGP는 프로토콜 이름이 아니라 라우팅 프로토콜의 종류

| 종류 | 라우팅 프로토콜                                    | 동작         |
| ---- | -------------------------------------------------- | ------------ |
| EGP  | EGP (Exterior Gateway Protocol)                    | 디스턴스벡터 |
| EGP  | EGP (Boder Gateway Protocol)                       | 경로벡터     |
| IGP  | RIP (Rounting Information Protocol)                | 디스턴스벡터 |
| IGP  | OSPF (Open Shortest Path First)                    | 링크상태     |
| IGP  | IS-IS (IntermediateSystem to IntermediateSystem)   | 링크상태     |
| IGP  | EIGRP (Enhanced Interior Gateway Routing Protocol) | 하이브리드   |

사용하는 장소에 따라 EGP와 IFO의 두 종류로 나누고, 동작 방식에 따라 네 종류로 나눌 수 있음

### 라우팅 프로토콜의 역할

라우터는 근접해 있는 라우터 간의 네트워크 정보를 서로 교환한다

라우팅 프로토콜이 결정하는 것

- 정보교환을 언제 할지
- 어떻게 할지
- 누구에게 전송할지
- 어떤 정보를 전송할지

모든 라우터가 동일한 경로 정보를 갖는다

1. 라우터는 자신이 접하고 있는 네트워크를 테이블에 유지관리하고 있다.
2. 라우팅 프로토콜을 사용하여 가지고 있는 네트워크의 정보를 서로 교환한다
3. 교환한 정보를 사용하여 라우팅 테이블을 갱신한다

라우팅 프로토콜이 결정한 방식에 따라 정보를 교환해 컨버전스 상태에 도달

컨버전스 

이렇게 교환한 경로 정보를 기준으로 최적의 경로를 라우팅 테이블이 기재

- 항상 최적의 경로가 사용 가능

## RIP

### 메트릭

메트릭(Metric)

- 최적의 경로를 결정할 때의 판단기준
- 판단 기준에 따라 라우팅 프로토콜에 의해 결정된 값을 계산해서 그 중 최소 값을 갖는 것을 최적의 경로로 결정
  - 중계하는 라우터의 수
  - 회선의 속도
  - 정체상태
  - 에러 발생률

### RIP

디스턴스벡터 : 거리와 방향

- 디스턴스  :  거리

- 벡터 : 방향

#### 라우팅 업데이트

RIP에서 라우터가 다른 라우터와 교환하는 정보

경로갱신 정보

라우팅 테이블을 그대로 교환

30초에 1번

이 업데이트를 6번 수신 받지 않으면 그 라우터에는 뭔가 장애가 발생했다고 간주해서 그 라우터를 사용하는 경로들을 파기해버림

- 응답이 없으니까 더 이상 필요 없다

라우팅 업데이트를 교환하고 모르는 경로 정보를 입수한다

1. 자신에게 접속해 있는 네트워크를 포함해서 인접하고 있는 라우터 정보가 RIP에 의해 라우팅 테이블에 추가된다
2. 다음 갱신에서 방금 전 갱신된 정보가 송수신된다. (라우터B에 라우터 C의 정보가 도달하고, 라우터C에 라우터B의 정보가 A를 경유해서 도달해 있다) 이것으로 컨버전스가 된다

RIP는 메트릭에서 홉 수를 사용한다

- 홉 수
  - 수신처 네트워크까지 통과하는 라우터 수
  - 그래서 직접 접속되어 있는 네트워크의 메트릭은 0인 것이다

업데이트를 보내 온 라우터를 그 앞의 네트워크에의 중계라우터로, 업데이트를 받은 인터페이스를 그 앞의 네트워크에의 송신 인터페이스로 정하도록 함

- 이렇게 해서 근접해 있는 라우터가 알고 있는 네트워크 정보를 얻을 수 있음
- 가르쳐준 라우터가 있는 '방향'이 수신처 네트워크의 경로가 됨

이미 테이블에 존재하는 네트워크에 대해서 새로운 정보가 업데이트되어 새로운 경로 쪽이 메트릭이 작으면 그쪽을 테이블에 기재한다

- 새로운 경로쪽의 메트릭이 크면 그것은 무시
- 메트릭이라는 경로를 평가하는 기준은 RIP라면 홉 수가 됨
- 홉 수라는 것은 경유하는 라우터 수를 의미하기 때문에 개념상으로 '거리'라고 해도 좋다

방향과 거리

- 방향 : 가르쳐 준 라우터가 있는 방향
- 거리 : 홉 수

## ICMP

### ICMP

3계층의 프로토콜은 IP 이외에도 존재한다

ICMP(Internet Control Message Protocol)

- 인터넷 제어 메시지 프로토콜
- 에러 보고 프로토콜

네트워크의 제어 · 관리 등을 수행하는 프로토콜

1. 호스트A에서  호스트B에 IP 패킷을 송신하고 싶지만, 라우터는 호스트B가 있는 네트워크의 경로를 몰랐다
2. 라우터는 송신처에 도달할 수 없다는 것을 나타애는 송신 불능 메시지를 ICMP로 호스트 A에게 통지한다

송신 불능 메시지를 받은 대응은 각각의 애플리케이션마다 다르다

IP데이터그램에 IMCP 메시지를 넣음

- IP 데이터그램의 페이로드에 넣음

- 보통 IP 데이터그램의 페이로드에는 TCP 세그먼트라든지 UDP 데이터그램이 들어감
- 대신 ICMP 메시지를 넣어서 보냄
- IP 헤더 + ICMP 메시지 형태

일반적인 IP 패킷

| 이더넷 프레임 | IP 패킷 | 세그먼트 | 데이터 |
| ------------- | ------- | -------- | ------ |

ICPM 패킷

| 이더넷 프레임 | IP 해더 | ICMP 메시지 |
| ------------- | ------- | ----------- |

ICMP 메시지

| 타입  | 코드  | 체크섬 | 옵션  | 데이터  |
| ----- | ----- | ------ | ----- | ------- |
| 1옥텟 | 1옥텟 | 2옥텟  | 4옥텟 | ~64옥텟 |

- 타입
  - ICMP의 종류
- 코드
  - 그 상세 내용

### ICMP의 종류

Query 메시지

- 상태를 조사하기 위해 사용되는 메시지

Error 메시지

- 에러를 통지하기 위한 메시지

ICMP는 상태 조사에서도 사용됨

2종류에 여러 타입이 존재

- 메시지 안의 '타입'에 숫자로 표시
- 11종류

| 번호 | 데이터                  |                             | 종류  |
| ---- | ----------------------- | --------------------------- | ----- |
| 0    | Echo Reply              | Echo응답                    | Query |
| 3    | Destination Unreachable | 수신처 도달 불가            | Error |
| 4    | Source Quench           | 전송 제어 지시              | Error |
| 5    | Redirect                | 최정경로 통지               | Error |
| 8    | Echo Request            | 요청                        | Query |
| 11   | Time Exceeded           | 시간 초과에 의한 패킷 제거  | Error |
| 12   | Prameter Problem        | 잘못된 파라미터에 의한 에러 | Error |
| 13   | Timestamp Request       | 타임 스탬프 요청            | Query |
| 14   | Timestamp Reply         | 타임 스탬프 응답            | Query |
| 15   | Information Request     | (미사용)                    | Query |
| 16   | Information Reply       | (미사용)                    | Query |

- 1번이랑 2번이랑 7번 
  - 본래 정의되어 있지 않은 번호
- 0,3,5,8,11번이 자주사용된다

Destination Unreachable

수신처에 도달하지 않는 이유를 통지한다

- 수신처에 도달할 수 없는 경우 라우터 또는 호스트가 타입3인 Destination Unreachable을 보낸다 

- 그 때, 도달할 수 없는 이유를 코드에 넣는다

- | 타입 | 코드 | 체크섬     | 옵션 | 데이터 |
  | ---- | ---- | ---------- | ---- | ------ |
  | 3    |      | [checksum] | 없음 |        |

  코드

  | 타입 | 타입                            | 타입                                                   |
  | ---- | ------------------------------- | ------------------------------------------------------ |
  | 0    | Net Reachable                   | 네트워크에 도달 불능                                   |
  | 1    | Host Unreachable                | 호스트에 도달 불능                                     |
  | 2    | Protocol Unreachable            | 그 프로토콜은 사용할 수 없다                           |
  | 3    | Port Unreachable                | 대상 포트가 닫혀있다                                   |
  | 4    | Fragmentation Needed and DF set | IP 패킷을 분할하고 싶지만 분할이 불가능하도록 되어있다 |

### TTL

IP 해더 항목

TTL(TIme To Live)

- 생존시간
- IP 데이터그램의 TTL은 라우터를 경유할 때마다 1만큼씩 줄어들고, 0이되면 그 데이터그램은 파기됨
- 그래서 IP 데이터그램의 '생존시간'이라는 것이다

필요한 이유

- 라우팅에서 경로 정보에 오류가 일어날 수 있음
  - 정적 라우팅 테이블에서 수동으로 경로를 입력할 때 중계 라우터를 틀리는 경우도 있다
- 수신처에 도달하지 않고 어딘가로 가버리든지 또는 같은 장소를 빙글빙글 계속해서 돌게 됨
- 그 데이터그램은 영원히 네트워크 내에서 계속해서 순환하게 되니까 방해만 될 뿐임

Linux에서는 64개 Windows에서는 128개의 라우터를 경유하면 파기됨

## Echo와 Time Exceeded

### Echo

#### Destination Unreachable

- 수신처 도달불가능을 통지하는 메시지 설명

#### Echo

타입 0

- 에코 응답(Echo Reply)

타입 8

- 에코 요청(Echo Request)

송신측은 에코 요청을 보내고, 그것을 수신한 컴퓨터는 에코 응답을 돌려 보내는 구조

Echo Request와 Echo Reply

에코 요청을 수신하면, 에코 응답을 보낸다

1. 호스트A에서 호스트B에 Echo Request(에코 요청)을 송신하면···
2. 수신한 호스트B는 송신처(호스트A)에게 Echo Reply(에코 응답)을 보낸다.

#### ping

이 Echo 개념을 이용

임의의 수신처에게 에코 요청을 보내는 소프트웨어

네트워크 관리자의 필수품

에코 요청과 응답을 서로 주고받는 것은 송신처와 수신처 간의 데이터를 송수신할 수 있다는 의미

- ICMP 패킷이 송신처와 수신처 사이를 오고 갈 수 있다는 것
- 만약에 에코 요청을 보냈는데 에코 응답이 돌아오지 않으면 가는 길 또는 돌아오는 길 둘 중에 어딘가 문제가 생겨서 송수신할 수 없다는 것

네트워크 상태를 조사할 수 있다

- 에코의 요청과 응답에 걸리는 시간을 측정

ping이라는 소프트웨어가 조사 가능

- 수신처와의 통신 가능성
- 그 상태

### Time Exceeded

타입11

- Time Exceeded : 시간초과에 의한 패킷 파기

TTL과 관련이 있다

TTL은 끊어진 패킷을 파기하는데 이 때 파기한 것을 통지하는 메시지

TTL이 끝나서 데이터그램이 파기되면 파기된 라우터는 Time Exceed를 송신한다

1. TTL은 라우터를 경유할 때마다 1씩 감소하여 0이 되면
2. 데이터그램은 파기되고 파기한 라우터는 송신처에 Time Exceeded를 보낸다

traceroute

- 이 타입11을 사용한 네트워크의 체크용 소프트웨어

- 수신처까지의 경로를 가르쳐 주는 소프트웨어
- 수신처에 도달하기까지 경유하는 라우터를 가르쳐 줌

1. TTL=1에서 수신처에 패킷을 보내면, 첫번째 라우터에서 Time Exceeded를 보낸다
2. 다음은 TTL=2에서 수신처에 패킷을 보내고, 두번째 라우터에서 Time Exceeded를 보낸다
3. 이후부터 TTL을 1씩 늘려가고 수신처까지 패킷을 전달한다
4. 수신처까지 데이터가 도달해 응답 패킷을 수신하면, 지금까지 Time Exceed를 보내온 라우터를 표시한다. 그것이 수신처까지의 경우 라우터C의 라우터 일람표가 된다

이느 경로를 거쳐 갔는지 알 수 있다

- 의도적으로 에러메시지를 받아 그것을 표로 만들어감

ping : 수신처에 도달했는지 어떤지 확인할 수 있음

traceroute : 도중에 어떤 경로를 통해 갈지를 알아낼 수 있다

라우터 관리자는 ICMP 운용에 주의할 필요가 있음

- 크래커 공격에 이용되기도 함
- traceroute를 통해 IP 주소를 알아낼 수 있음 라우터의IP 주소를 알면 거기를 공격할 수가 있고 라우터가 공격을 받아 이상해지면 네트워크에 광범위하게 영향을 끼치게 됨





