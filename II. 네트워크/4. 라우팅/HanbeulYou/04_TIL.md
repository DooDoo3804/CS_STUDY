# 하루 3분 네트워크 교실

## 4. 라우팅

### 1. 주소와 경로

- IP 주소와 MAC 주소
    - IP 주소는 수신처의 컴퓨터를 결정 → 최종 수신처
    - MAC 주소는 같은 네트워크 내에서의 수신처를 결정 → 다음 수신처
    - MAC 주소로 ‘다음에 보낼 장소’를 지정 → 거기에 도달하면 → 다시 MAC 주소로 ‘다음에 보낼 장소’를 지정 → 반복
- 경로
    - MAC 주소로 ‘다음 수신처’를 지정하고 IP 주소로 ‘최종 수신처’를 지정해 최종 수신처까지의 경로가 만들어짐
        - 라우터라는 장치가 이 경로를 결정함(다음에 어디로 보내야 할지)
    - 홉 바이 홉(Hop-by-hop) : 이처럼 ‘다음 길’을 제시해 가는 방식
        - 이 과정을 반복해 ‘경로’가 만들어지고 라우터가 네트워크 경계상에 배치되어 전송 받은 데이터그램을 라우팅함(다음 수신처를 결정)
    - 다음 수신처 : 수신처에 가기 위한 다음 라우터(같은 네트워크에 있을 경우 수신처의 컴퓨터 자체)
    - 라우터가 없으면 다른 네트워크에 데이터그램을 보낼 수 없음

---

### 2. 라우터

- 라우터란
    - 라우터는 라우팅을 하고 다른 네트워크로 데이터를 전송 → 인터넷 작업에 있어서 가장 중요한 장치
    - 복수의 인터페이스를 가질 수 있음 / 복수의 네트워크에 연결되어 있음
    - 라우터의 인터페이스에는 IP 주소가 설정되어 있음 → 각 인터페이스는 각각의 네트워크에 소속됨
    - ‘라우팅을 한다’ : 데이터그램의 수신처 IP 주소를 근거로 다음에 송신하는 라우터를 결정
    - 복수의 네트워크끼리(다른 종류의 네트워크 포함) ‘연결’하는 역할을 함(데이터 중계)
    - 데이터그램에 대해 조건을 붙여 해당 데이터그램을 파기하는 ‘필터링’이라는 처리를 하기도 함
- 라우터의 동작
    - 라우팅 테이블
        - 최적 경로의 지도(라우터가 수신한 패킷이 수신처까지 도달하기 위한 최적의 경로가 그려진 지도)
        - 수신처 네트워크까지의 거리, 다음에 도달하는 라우터, 그 라우터에 연결되어 있는 자신의 인터페이스 등이 기재되어 있음
        - 최장일치의 룰(Longest Match)라는 규칙으로 다음 수신처를 찾음
        - 수신처 IP 주소와 비트가 가장 일치하는 것을 선택(프리픽스 길이까지 일치한 것 중에서도 가장 프리픽스 길이가 긴 경로 선택)

---

### 3. 디폴트 게이트웨이

- 브로드캐스트 도메인
    - 브로드캐스트는 라우터를 넘어서 전송할 수 없음
    - 라우터가 네트워크를 나눠 브로드캐스트가 다른 네트워크에 송신되지 않도록 함 → 브로드캐스트가 도달하는 범위를 브로드캐스트 도메인이라고 함
    - 스위치 → 충돌 도메인 / 라우터 → 브로드캐스트 도메인 / 허브 → X
- ARP와 라우터
    - ARP는 브로드캐스트 → 라우터가 ARP를 다른 네트워크에 전송 X
    - 따라서 ARP는 수신처까지 도달하지 않음
    - 디폴트 게이트웨이가 네트워크의 출입구가 됨
- 디폴트 게이트웨이
    - 디폴트 게이트웨이로 데이터를 보내서 다른 네트워크로 전송 → 컴퓨터가 최초로 데이터를 보내는 수신처는 디폴트 게이트웨이가 됨
    - 컴퓨터는 다른 네트워크에 데이터를 송신할 때 디폴트 게이트웨이로 ARP를 수행 → ARP로 디폴트 게이트웨이의 MAC 주소를 얻음
    - 컴퓨터는 디폴트 게이트웨이의 IP 주소를 미리 설정해 둠(수동, DHCP)

---

### 4. 라우팅

- 라우팅 테이블
    - 라우팅 테이블 : 수신처 네트워크, 중계지점, 메트릭, 수신처의 출구가 기재되어 있는 표
    - 라우터는 수신처 네트워크를 결정
    - 라우터는 수신처 네트워크 주소와 라우팅 테이블을 비교해서 경로를 찾아냄
    - 라우팅 테이블에 수신처 네트워크가 없을 때엔 수신처 불명으로 데이터그램을 파기
- 2개의 라우팅
    - 수신처 네트워크까지의 최적 경로를 알아내는 법
        - 최적의 경로를 찾기 위해 다른 네트워크 경로를 모두 알아야 함
        - 알고 있는 경로 중에서 최적 경로를 선택해 라우팅 테이블을 작성
        - 모든 경로를 아는 방법 : 정적 라우팅 & 동적 라우팅
    - 정적 라우팅
        - 관리자가 수동으로 경로를 입력
        - 수동으로 입력한 경로를 사용할 수 없게 되는 경우 관리자가 수동으로 경로를 재갱신해주어야 함
    - 동적 라우팅
        - 라우터가 자동으로 정보를 서로 교환해서 경로를 알아내는 방법
        - 모든 경로 중에서 자동으로 최적의 경로를 선택해서 라우팅 테이블을 작성
        - 라우터끼리 정보 교환 → 데이터를 주고받기 때문에 회선 전송을 압박 함(데이터 전송에 사용되는 분량 감소)
        - 저속 회선의 경우 주의 필요
        - 서로 교환한 정보를 가지고 최적의 경로 계산 → 라우터의 처리능력 필요
        - 모든 라우터가 동일한 정보를 가져야 함(컨버전스 상태)

---

### 5. 라우팅 프로토콜

- 자율화 시스템(Autonomous System)
    - 중복성 유지를 위해 대규모 네트워크에서 동적 라우팅은 필수
    - 동적 라우팅을 실현할 라우팅 프로토콜(Routing Protocol)을 사용 → 근접해 있는 라우터 간의 네트워크 정보를 교환
        - 교환한 정보를 근거로 라우팅 테이블 변경
    - 자율화 시스템(AS)
        - 하나의 관리 단체에 의해 관리되는 네트워크 집합체
        - 라우팅에서는 AS는 한 개의 범위로써 취급
        - AS에는 식별하기 위한 유일한 번호가 부여되어 있음
- 라우팅 프로토콜의 종류
    - AS 간 라우팅용 프로토콜 : EGP(Exterior Gateway Protocol)
        - EGP(Exterior Gateway Protocol) → 디스턴스 벡터
        - BGP(Border Gateway Protocol) → 경로 벡터
    - AS 내부 라우팅용 프로토콜 : IGP(Interior Gateway Protocol)
        - RIP(Routing Information Protocol) → 디스턴스 벡터
        - OSPF(Open Shortest Path First) → 링크 상태
        - IS-IS(Intermediate System to Intermediate System) → 링크 상태
        - EIGRP(Enhanced Interior Gateway Routing Protocol) → 하이브리드
- 라우팅 프로토콜의 역할
    - 근접해 있는 라우터 간의 네트워크 정보를 서로 교환
    - 정보교환을 언제 할지, 어떻게 할지, 누구에게 전송할지, 어떤 정보를 전송할지 결정
    - 라우팅 프로토콜이 결정한 방식에 따라 정보를 교환해 컨버전스 상태에 도달
    - 이렇게 교환한 경로 정보를 기준으로 최적의 경로를 라우팅 테이블에 기재 → 항상 최적의 경로 사용 가능

---

### 6. RIP

- 메트릭(Metric)
    - 최적의 경로를 결정할 때의 판단 기준
    - 중계하는 라우터의 수, 회선의 속도, 정체상태, 에러 발생률 등의 판단 기준 → 계산하여 최소 값을 갖는 것을 최적의 경로로 결정
- RIP
    - 디스턴스벡터 : 거리와 방향
    - 라우팅 업데이트(Routing Update) : 라우터가 다른 라우터와 교환하는 정보
        - 라우팅 테이블을 그대로 교환
        - 30초에 1번 정기적으로 주고받음
        - 6번 수신 받지 않으면 해당 라우터에 장애가 발생했다고 간주 → 해당 라우터를 사용하는 경로들 파기
    - RIP는 메트릭에서 홉 수를 사용(수신처 네트워크까지 통과하는 라우터 수)
        - 직접 접속되어 있는 네트워크의 메트릭 == 0
    - 업데이트 수신하면 자기가 모르는 네트워크를 테이블에 추가
        - 업데이트를 보내온 라우터를 그 앞의 네트워크에의 중계 라우터로
        - 업데이트를 받은 인터페이스를 그 앞의 네트워크에의 송신 인터페이스로 정함
    - 메트릭으로 경로를 비교해 메트릭이 작은 쪽을 라우팅 테이블에 기재

---

### 7. ICMP

- ICMP(Internet Control Message Protocol)
    - 인터넷 제어 메시지 프로토콜(에러 보고 프로토콜)
    - 송신 불능 메시지를 받은 호스트 : 애플리케이션마다 대응이 다름
    - 네트워크의 제어, 관리에 사용됨
    - IP 데이터그램에 ICMP 메시지를 넣어 데이터를 주고 받음
        - IP 데이터그램의 페이로드에는 TCP 세그먼트, UDP 데이터그램이 들어감 → 대신 ICMP 메시지를 넣어서 보냄
        - 즉, IP 헤더 + ICMP 메시지 형태
    - 타입 : ICMP의 종류
    - 코드 : ICMP의 상세 내용
- ICMP의 종류
    - Query 메시지
        - 상태를 조사하기 위해 사용
        - 타입 0 : Echo Reply - Echo 응답
        - 타입 8 : Echo Request - 요청
        - 타입 13 : Timestamp Request - 타임 스탬프 요청
        - 타입 14 : Timestamp Reply - 타임 스탬프 응답
        - 타입 15 : (미사용)
        - 타입 16 : (미사용)
    - Error 메시지
        - 에러를 통지하기 위한 메시지
        - 타입 3 : Destination Unreachable - 수신처 도달 불가
        - 타입 4 : Source Quench - 전송 제어 지시
        - 타입 5 : Redirect - 최적 경로 통지
        - 타입 11 : Time Exceeded - 시간 초과에 의한 패킷 제거
        - 타입 12 : Parameter Problem - 잘못된 파라미터에 의한 에러
- TTL(Time To Live)
    - 생존 시간
    - IP 데이터그램의 TTL은 라우터를 경유할 때마다 1만큼씩 줄어들고, 0이 되면 그 데이터그램은 파기됨
        - 라우팅에서 경로 정보에 오류가 일어날 수도 있음 → 영원히 네트워크 내에서 계속해서 순환하게 되는 경우 방지

---

### 8. Echo와 Time Exceeded

- Echo
    - 타입 0 : 에코 응답
        - 수신측(수신할 경우 응답)
    - 타입 8 : 에코 요청
        - 송신측(에코 요청 송신)
    - 임의의 수신처에 ping이라는 에코 요청을 보냄
        - 에코 응답을 받았을 경우 송신처와 수신처 간의 데이터를 송수신할 수 있다는 의미
        - 에코의 요청과 응답에 걸리는 시간을 측정해 네트워크 상태 조사 가능
- Time Exceede
    - 타입 11 : 시간 초과에 의한 패킷 파기
        - TTL은 끊어진 패킷을 파기 → Time Exceeded로 통지
    - traceroute 라는 소프트웨어로 수신처까지의 경로를 알 수 있음
        - 수신처에 도달하기까지 경유하는 라우터
- ping과 traceroute를 통해 얻은 정보는 크래커(Cracker) 공격에 이용되기도 함
    - 라우터 관리자는 ICMP 운용에 주의해야 함

---

